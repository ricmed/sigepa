{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - SIGEPA{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-background py-4 mb-4">
    <div class="container hero-content">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-5 text-white fw-bold mb-2">
                    <i class="fas fa-{% if 'Nova' in title %}plus{% else %}edit{% endif %} me-3"></i>
                    {{ title }}
                </h1>
                <p class="lead text-white mb-0">
                    {% if 'Nova' in title %}
                        Registre uma nova ocorr√™ncia de escalpelamento
                    {% else %}
                        Edite os dados da ocorr√™ncia existente
                    {% endif %}
                </p>
            </div>
            <div class="col-lg-4 text-end">
                <a href="{% url 'core:ocorrencia_list' %}" class="btn btn-outline-light">
                    <i class="fas fa-arrow-left me-1"></i> Voltar
                </a>
            </div>
        </div>
    </div>
</div>

<form method="post" id="ocorrencia-form">
    {% csrf_token %}
    
    <ul class="nav nav-tabs" id="ocorrencia-tabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="notificacao-tab" data-bs-toggle="tab" 
                    data-bs-target="#notificacao" type="button" role="tab">
                Dados da Notifica√ß√£o
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="paciente-tab" data-bs-toggle="tab" 
                    data-bs-target="#paciente" type="button" role="tab">
                Dados do Paciente
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="endereco-tab" data-bs-toggle="tab" 
                    data-bs-target="#endereco" type="button" role="tab">
                Endere√ßo
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="acidente-tab" data-bs-toggle="tab" 
                    data-bs-target="#acidente" type="button" role="tab">
                Dados do Acidente
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="transferencia-tab" data-bs-toggle="tab" 
                    data-bs-target="#transferencia" type="button" role="tab">
                Transfer√™ncia
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="investigador-tab" data-bs-toggle="tab" 
                    data-bs-target="#investigador" type="button" role="tab">
                Investigador
            </button>
        </li>
    </ul>

    <div class="tab-content" id="ocorrencia-tab-content">
        <div class="tab-pane fade show active" id="notificacao" role="tabpanel">
            <div class="card mt-3">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="{{ form.tipo_notificacao.id_for_label }}" class="form-label">
                                Tipo de Notifica√ß√£o *
                            </label>
                            {{ form.tipo_notificacao }}
                            {% if form.tipo_notificacao.errors %}
                                <div class="text-danger">{{ form.tipo_notificacao.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.data_notificacao.id_for_label }}" class="form-label">
                                Data da Notifica√ß√£o *
                            </label>
                            {{ form.data_notificacao }}
                            {% if form.data_notificacao.errors %}
                                <div class="text-danger">{{ form.data_notificacao.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_uf_notificacao.id_for_label }}" class="form-label">
                                UF da Notifica√ß√£o *
                            </label>
                            {{ form.id_uf_notificacao }}
                            {% if form.id_uf_notificacao.errors %}
                                <div class="text-danger">{{ form.id_uf_notificacao.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_municipio_notificacao.id_for_label }}" class="form-label">
                                Munic√≠pio da Notifica√ß√£o *
                            </label>
                            {{ form.id_municipio_notificacao }}
                            {% if form.id_municipio_notificacao.errors %}
                                <div class="text-danger">{{ form.id_municipio_notificacao.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_cnes.id_for_label }}" class="form-label">
                                CNES *
                            </label>
                            <div class="input-group">
                                {{ form.id_cnes }}
                                <button type="button" class="btn btn-outline-secondary" onclick="openSearchModal('estabelecimentos', '#id_id_cnes')">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            {% if form.id_cnes.errors %}
                                <div class="text-danger">{{ form.id_cnes.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.data_acidente.id_for_label }}" class="form-label">
                                Data do Acidente
                            </label>
                            {{ form.data_acidente }}
                            {% if form.data_acidente.errors %}
                                <div class="text-danger">{{ form.data_acidente.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.data_cadastro.id_for_label }}" class="form-label">
                                Data do Cadastro
                            </label>
                            {{ form.data_cadastro }}
                            {% if form.data_cadastro.errors %}
                                <div class="text-danger">{{ form.data_cadastro.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row g-3 mt-3">
                        <div class="col-12 d-flex justify-content-between">
                            <a href="{% url 'core:ocorrencia_list' %}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancelar
                            </a>
                            <button type="button" class="btn btn-primary" onclick="goToNextTab('paciente-tab')">
                                Pr√≥ximo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="paciente" role="tabpanel">
            <div class="card mt-3">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="{{ form.nome_paciente.id_for_label }}" class="form-label">
                                Nome do Paciente *
                            </label>
                            {{ form.nome_paciente }}
                            {% if form.nome_paciente.errors %}
                                <div class="text-danger">{{ form.nome_paciente.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label for="{{ form.data_nascimento.id_for_label }}" class="form-label">
                                Data de Nascimento
                            </label>
                            {{ form.data_nascimento }}
                            {% if form.data_nascimento.errors %}
                                <div class="text-danger">{{ form.data_nascimento.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label for="{{ form.idade.id_for_label }}" class="form-label">
                                Idade
                            </label>
                            {{ form.idade }}
                            {% if form.idade.errors %}
                                <div class="text-danger">{{ form.idade.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label for="{{ form.id_sexo.id_for_label }}" class="form-label">
                                Sexo *
                            </label>
                            {{ form.id_sexo }}
                            {% if form.id_sexo.errors %}
                                <div class="text-danger">{{ form.id_sexo.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label for="{{ form.id_tempo_gestacao.id_for_label }}" class="form-label">
                                Tempo de Gesta√ß√£o *
                            </label>
                            {{ form.id_tempo_gestacao }}
                            {% if form.id_tempo_gestacao.errors %}
                                <div class="text-danger">{{ form.id_tempo_gestacao.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label for="{{ form.id_raca.id_for_label }}" class="form-label">
                                Ra√ßa *
                            </label>
                            {{ form.id_raca }}
                            {% if form.id_raca.errors %}
                                <div class="text-danger">{{ form.id_raca.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label for="{{ form.id_povo_tradicional.id_for_label }}" class="form-label">
                                Povo Tradicional
                            </label>
                            {{ form.id_povo_tradicional }}
                            {% if form.id_povo_tradicional.errors %}
                                <div class="text-danger">{{ form.id_povo_tradicional.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.cartao_sus.id_for_label }}" class="form-label">
                                Cart√£o SUS
                            </label>
                            {{ form.cartao_sus }}
                            {% if form.cartao_sus.errors %}
                                <div class="text-danger">{{ form.cartao_sus.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.cpf.id_for_label }}" class="form-label">
                                CPF
                            </label>
                            {{ form.cpf }}
                            {% if form.cpf.errors %}
                                <div class="text-danger">{{ form.cpf.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_cbo.id_for_label }}" class="form-label">
                                CBO
                            </label>
                            <div class="input-group">
                                {{ form.id_cbo }}
                                <button type="button" class="btn btn-outline-secondary" onclick="openSearchModal('cbo', '#id_id_cbo')">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            {% if form.id_cbo.errors %}
                                <div class="text-danger">{{ form.id_cbo.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.nome_mae.id_for_label }}" class="form-label">
                                Nome da M√£e
                            </label>
                            {{ form.nome_mae }}
                            {% if form.nome_mae.errors %}
                                <div class="text-danger">{{ form.nome_mae.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label for="{{ form.id_escolaridade.id_for_label }}" class="form-label">
                                Escolaridade
                            </label>
                            {{ form.id_escolaridade }}
                            {% if form.id_escolaridade.errors %}
                                <div class="text-danger">{{ form.id_escolaridade.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label for="{{ form.id_pais.id_for_label }}" class="form-label">
                                Pa√≠s
                            </label>
                            {{ form.id_pais }}
                            {% if form.id_pais.errors %}
                                <div class="text-danger">{{ form.id_pais.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row g-3 mt-3">
                        <div class="col-12 d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="goToPreviousTab('notificacao-tab')">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-primary" onclick="goToNextTab('endereco-tab')">
                                Pr√≥ximo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="endereco" role="tabpanel">
            <div class="card mt-3">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="{{ form.id_uf_residencia.id_for_label }}" class="form-label">
                                UF de Resid√™ncia
                            </label>
                            {{ form.id_uf_residencia }}
                            {% if form.id_uf_residencia.errors %}
                                <div class="text-danger">{{ form.id_uf_residencia.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_municipio_residencia.id_for_label }}" class="form-label">
                                Munic√≠pio de Resid√™ncia
                            </label>
                            {{ form.id_municipio_residencia }}
                            {% if form.id_municipio_residencia.errors %}
                                <div class="text-danger">{{ form.id_municipio_residencia.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_zona.id_for_label }}" class="form-label">
                                Zona
                            </label>
                            {{ form.id_zona }}
                            {% if form.id_zona.errors %}
                                <div class="text-danger">{{ form.id_zona.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.distrito.id_for_label }}" class="form-label">
                                Distrito
                            </label>
                            {{ form.distrito }}
                            {% if form.distrito.errors %}
                                <div class="text-danger">{{ form.distrito.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.bairro.id_for_label }}" class="form-label">
                                Bairro
                            </label>
                            {{ form.bairro }}
                            {% if form.bairro.errors %}
                                <div class="text-danger">{{ form.bairro.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-8">
                            <label for="{{ form.logradouro.id_for_label }}" class="form-label">
                                Logradouro
                            </label>
                            {{ form.logradouro }}
                            {% if form.logradouro.errors %}
                                <div class="text-danger">{{ form.logradouro.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-2">
                            <label for="{{ form.numero.id_for_label }}" class="form-label">
                                N√∫mero
                            </label>
                            {{ form.numero }}
                            {% if form.numero.errors %}
                                <div class="text-danger">{{ form.numero.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-2">
                            <label for="{{ form.cep.id_for_label }}" class="form-label">
                                CEP
                            </label>
                            {{ form.cep }}
                            {% if form.cep.errors %}
                                <div class="text-danger">{{ form.cep.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.complemento.id_for_label }}" class="form-label">
                                Complemento
                            </label>
                            {{ form.complemento }}
                            {% if form.complemento.errors %}
                                <div class="text-danger">{{ form.complemento.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.telefone.id_for_label }}" class="form-label">
                                Telefone
                            </label>
                            {{ form.telefone }}
                            {% if form.telefone.errors %}
                                <div class="text-danger">{{ form.telefone.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.geo_campo1.id_for_label }}" class="form-label">
                                Coordenada 1
                            </label>
                            {{ form.geo_campo1 }}
                            {% if form.geo_campo1.errors %}
                                <div class="text-danger">{{ form.geo_campo1.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.geo_campo2.id_for_label }}" class="form-label">
                                Coordenada 2
                            </label>
                            {{ form.geo_campo2 }}
                            {% if form.geo_campo2.errors %}
                                <div class="text-danger">{{ form.geo_campo2.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.ponto_referencia.id_for_label }}" class="form-label">
                                Ponto de Refer√™ncia
                            </label>
                            {{ form.ponto_referencia }}
                            {% if form.ponto_referencia.errors %}
                                <div class="text-danger">{{ form.ponto_referencia.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row g-3 mt-3">
                        <div class="col-12 d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="goToPreviousTab('paciente-tab')">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-primary" onclick="goToNextTab('acidente-tab')">
                                Pr√≥ximo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="acidente" role="tabpanel">
            <div class="card mt-3">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="{{ form.num_registro.id_for_label }}" class="form-label">
                                N√∫mero do Registro *
                            </label>
                            {{ form.num_registro }}
                            {% if form.num_registro.errors %}
                                <div class="text-danger">{{ form.num_registro.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.tipo_motor.id_for_label }}" class="form-label">
                                Tipo do Motor
                            </label>
                            {{ form.tipo_motor }}
                            {% if form.tipo_motor.errors %}
                                <div class="text-danger">{{ form.tipo_motor.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.data_investigacao.id_for_label }}" class="form-label">
                                Data da Investiga√ß√£o
                            </label>
                            {{ form.data_investigacao }}
                            {% if form.data_investigacao.errors %}
                                <div class="text-danger">{{ form.data_investigacao.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.data_atendimento.id_for_label }}" class="form-label">
                                Data do Atendimento
                            </label>
                            {{ form.data_atendimento }}
                            {% if form.data_atendimento.errors %}
                                <div class="text-danger">{{ form.data_atendimento.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.nome_dono.id_for_label }}" class="form-label">
                                Nome do Dono
                            </label>
                            {{ form.nome_dono }}
                            {% if form.nome_dono.errors %}
                                <div class="text-danger">{{ form.nome_dono.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.telefone_dono.id_for_label }}" class="form-label">
                                Telefone do Dono
                            </label>
                            {{ form.telefone_dono }}
                            {% if form.telefone_dono.errors %}
                                <div class="text-danger">{{ form.telefone_dono.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.nome_condutor.id_for_label }}" class="form-label">
                                Nome do Condutor
                            </label>
                            {{ form.nome_condutor }}
                            {% if form.nome_condutor.errors %}
                                <div class="text-danger">{{ form.nome_condutor.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.telefone_condutor.id_for_label }}" class="form-label">
                                Telefone do Condutor
                            </label>
                            {{ form.telefone_condutor }}
                            {% if form.telefone_condutor.errors %}
                                <div class="text-danger">{{ form.telefone_condutor.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.id_cid.id_for_label }}" class="form-label">
                                CID
                            </label>
                            <div class="input-group">
                                {{ form.id_cid }}
                                <button type="button" class="btn btn-outline-secondary" onclick="openSearchModal('cid', '#id_id_cid')">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            {% if form.id_cid.errors %}
                                <div class="text-danger">{{ form.id_cid.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.id_tipo_escalpelamento.id_for_label }}" class="form-label">
                                Tipo de Escalpelamento
                            </label>
                            {{ form.id_tipo_escalpelamento }}
                            {% if form.id_tipo_escalpelamento.errors %}
                                <div class="text-danger">{{ form.id_tipo_escalpelamento.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.id_causa_acidente.id_for_label }}" class="form-label">
                                Causa do Acidente
                            </label>
                            {{ form.id_causa_acidente }}
                            {% if form.id_causa_acidente.errors %}
                                <div class="text-danger">{{ form.id_causa_acidente.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.causa_acidente_outros.id_for_label }}" class="form-label">
                                Outras Causas
                            </label>
                            {{ form.causa_acidente_outros }}
                            {% if form.causa_acidente_outros.errors %}
                                <div class="text-danger">{{ form.causa_acidente_outros.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.id_municipio_ocorrencia.id_for_label }}" class="form-label">
                                Munic√≠pio da Ocorr√™ncia
                            </label>
                            {{ form.id_municipio_ocorrencia }}
                            {% if form.id_municipio_ocorrencia.errors %}
                                <div class="text-danger">{{ form.id_municipio_ocorrencia.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.data_cadastro_atendimento.id_for_label }}" class="form-label">
                                Data do Cadastro do Atendimento
                            </label>
                            {{ form.data_cadastro_atendimento }}
                            {% if form.data_cadastro_atendimento.errors %}
                                <div class="text-danger">{{ form.data_cadastro_atendimento.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-12">
                            <label for="{{ form.info_atendimento.id_for_label }}" class="form-label">
                                Informa√ß√µes do Atendimento
                            </label>
                            {{ form.info_atendimento }}
                            {% if form.info_atendimento.errors %}
                                <div class="text-danger">{{ form.info_atendimento.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row g-3 mt-3">
                        <div class="col-12 d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="goToPreviousTab('endereco-tab')">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-primary" onclick="goToNextTab('transferencia-tab')">
                                Pr√≥ximo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="transferencia" role="tabpanel">
            <div class="card mt-3">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="{{ form.transferencia_hospitalar.id_for_label }}" class="form-label">
                                Transfer√™ncia Hospitalar
                            </label>
                            {{ form.transferencia_hospitalar }}
                            {% if form.transferencia_hospitalar.errors %}
                                <div class="text-danger">{{ form.transferencia_hospitalar.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.data_transferencia.id_for_label }}" class="form-label">
                                Data da Transfer√™ncia
                            </label>
                            {{ form.data_transferencia }}
                            {% if form.data_transferencia.errors %}
                                <div class="text-danger">{{ form.data_transferencia.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_uf_transferencia.id_for_label }}" class="form-label">
                                UF da Transfer√™ncia
                            </label>
                            {{ form.id_uf_transferencia }}
                            {% if form.id_uf_transferencia.errors %}
                                <div class="text-danger">{{ form.id_uf_transferencia.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_municipio_transferencia.id_for_label }}" class="form-label">
                                Munic√≠pio da Transfer√™ncia
                            </label>
                            {{ form.id_municipio_transferencia }}
                            {% if form.id_municipio_transferencia.errors %}
                                <div class="text-danger">{{ form.id_municipio_transferencia.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.id_tipo_transporte.id_for_label }}" class="form-label">
                                Tipo de Transporte
                            </label>
                            {{ form.id_tipo_transporte }}
                            {% if form.id_tipo_transporte.errors %}
                                <div class="text-danger">{{ form.id_tipo_transporte.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-12">
                            <label for="{{ form.unidade_transferencia.id_for_label }}" class="form-label">
                                Unidade de Transfer√™ncia
                            </label>
                            {{ form.unidade_transferencia }}
                            {% if form.unidade_transferencia.errors %}
                                <div class="text-danger">{{ form.unidade_transferencia.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row g-3 mt-3">
                        <div class="col-12 d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="goToPreviousTab('acidente-tab')">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-primary" onclick="goToNextTab('investigador-tab')">
                                Pr√≥ximo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="investigador" role="tabpanel">
            <div class="card mt-3">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="{{ form.id_municipio_investigador.id_for_label }}" class="form-label">
                                Munic√≠pio do Investigador
                            </label>
                            {{ form.id_municipio_investigador }}
                            {% if form.id_municipio_investigador.errors %}
                                <div class="text-danger">{{ form.id_municipio_investigador.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.id_cnes_invertigador.id_for_label }}" class="form-label">
                                CNES do Investigador
                            </label>
                            <div class="input-group">
                                {{ form.id_cnes_invertigador }}
                                <button type="button" class="btn btn-outline-secondary" onclick="openSearchModal('estabelecimentos', '#id_id_cnes_invertigador')">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            {% if form.id_cnes_invertigador.errors %}
                                <div class="text-danger">{{ form.id_cnes_invertigador.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.nome_invertigador.id_for_label }}" class="form-label">
                                Nome do Investigador *
                            </label>
                            {{ form.nome_invertigador }}
                            {% if form.nome_invertigador.errors %}
                                <div class="text-danger">{{ form.nome_invertigador.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.funcao_invertigador.id_for_label }}" class="form-label">
                                Fun√ß√£o do Investigador
                            </label>
                            <div class="input-group">
                                {{ form.funcao_invertigador }}
                                <button type="button" class="btn btn-outline-secondary" onclick="openSearchModal('cbo', '#id_funcao_invertigador')">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            {% if form.funcao_invertigador.errors %}
                                <div class="text-danger">{{ form.funcao_invertigador.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row g-3 mt-3">
                        <div class="col-12 d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="goToPreviousTab('transferencia-tab')">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> {{ button_text }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Modais de Pesquisa -->
<!-- Modal para CNES/Estabelecimentos -->
<div class="modal fade" id="modalEstabelecimentos" tabindex="-1" aria-labelledby="modalEstabelecimentosLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalEstabelecimentosLabel">Pesquisar Estabelecimento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="searchEstabelecimentos" class="form-label">Pesquisar Estabelecimentos:</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchEstabelecimentos" placeholder="Digite o CNES ou nome do estabelecimento...">
                        <button class="btn btn-primary" type="button" onclick="executeSearchFromButton('estabelecimentos')">
                            <i class="fas fa-search"></i> Pesquisar
                        </button>
                        <button class="btn btn-outline-secondary" type="button" onclick="clearSearch('estabelecimentos')">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
                <div id="loadingEstabelecimentos" class="text-center d-none">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                </div>
                <div id="resultsEstabelecimentos"></div>
                <nav>
                    <ul class="pagination justify-content-center" id="paginationEstabelecimentos"></ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Modal para CBO -->
<div class="modal fade" id="modalCbo" tabindex="-1" aria-labelledby="modalCboLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalCboLabel">Pesquisar CBO</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="searchCbo" class="form-label">Pesquisar CBO (Ocupa√ß√£o):</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchCbo" placeholder="Digite o c√≥digo ou t√≠tulo da ocupa√ß√£o...">
                        <button class="btn btn-primary" type="button" onclick="executeSearchFromButton('cbo')">
                            <i class="fas fa-search"></i> Pesquisar
                        </button>
                        <button class="btn btn-outline-secondary" type="button" onclick="clearSearch('cbo')">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
                <div id="loadingCbo" class="text-center d-none">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                </div>
                <div id="resultsCbo"></div>
                <nav>
                    <ul class="pagination justify-content-center" id="paginationCbo"></ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Modal para CID -->
<div class="modal fade" id="modalCid" tabindex="-1" aria-labelledby="modalCidLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalCidLabel">Pesquisar CID</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="searchCid" class="form-label">Pesquisar CID (C√≥digo de Doen√ßa):</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchCid" placeholder="Digite o c√≥digo ou descri√ß√£o...">
                        <button class="btn btn-primary" type="button" onclick="executeSearchFromButton('cid')">
                            <i class="fas fa-search"></i> Pesquisar
                        </button>
                        <button class="btn btn-outline-secondary" type="button" onclick="clearSearch('cid')">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
                <div id="loadingCid" class="text-center d-none">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                </div>
                <div id="resultsCid"></div>
                <nav>
                    <ul class="pagination justify-content-center" id="paginationCid"></ul>
                </nav>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/ocorrencia-form.js' %}"></script>
<script>
// Fun√ß√µes de navega√ß√£o como fallback (caso n√£o sejam carregadas do arquivo externo)
if (typeof goToNextTab === 'undefined') {
    function goToNextTab(nextTabId) {
        console.log('‚û°Ô∏è Navegando para pr√≥xima aba:', nextTabId);
        const nextTab = document.getElementById(nextTabId);
        if (nextTab) {
            if (typeof bootstrap !== 'undefined' && bootstrap.Tab) {
                const nextTabButton = new bootstrap.Tab(nextTab);
                nextTabButton.show();
            } else {
                $(nextTab).tab('show');
            }
        }
    }
}

if (typeof goToPreviousTab === 'undefined') {
    function goToPreviousTab(previousTabId) {
        console.log('‚¨ÖÔ∏è Navegando para aba anterior:', previousTabId);
        const previousTab = document.getElementById(previousTabId);
        if (previousTab) {
            if (typeof bootstrap !== 'undefined' && bootstrap.Tab) {
                const previousTabButton = new bootstrap.Tab(previousTab);
                previousTabButton.show();
            } else {
                $(previousTab).tab('show');
            }
        }
    }
}

// Aguardar um pouco para garantir que o script foi carregado
window.addEventListener('load', function() {
    console.log('üìÑ P√°gina carregada completamente');
    
    // Verificar se as fun√ß√µes de navega√ß√£o foram definidas
    if (typeof goToNextTab === 'function') {
        console.log('‚úÖ Fun√ß√£o goToNextTab definida corretamente');
    } else {
        console.error('‚ùå Erro: fun√ß√£o goToNextTab n√£o encontrada');
    }
    
    if (typeof goToPreviousTab === 'function') {
        console.log('‚úÖ Fun√ß√£o goToPreviousTab definida corretamente');
    } else {
        console.error('‚ùå Erro: fun√ß√£o goToPreviousTab n√£o encontrada');
    }
    
    // Verificar se o script foi carregado corretamente
    if (typeof initializeFormulario === 'function') {
        console.log('‚úÖ Script ocorrencia-form.js carregado com sucesso');
    } else {
        console.error('‚ùå Erro: fun√ß√£o initializeFormulario n√£o encontrada');
    }
});
</script>
{% endblock %}